{% extends 'forum/forum_base.html' %}
{% load crispy_forms_tags %}
{% block title %}Detail{% endblock %}
{% block forum %}
{% if messages %}
 {% include 'messages.html' with toast_messages=messages %}
{% endif %}
<div class='col-12 col-md-10 mb-3'>
    <div class='card border text-dark'>
        <h4 class='card-header'>@{{ post_detail.user }}</h4>
       <div class='card-body'>
           {% if post_detail.image %}
           <img class="card-img-top" src="{{ post_detail.image.url }}">
           {% endif %}
           <h5 class='card-title'>{{ post_detail.title }}</h5>
           <p class='card-text'>
               <small class='text-muted'>{{ post_detail.created_time }}</small>
               {{ post_detail.content|linebreaks }}
           </p>
           {% if request.user == post_detail.user %}
            <div style="float:right">
                <a href="{{ post_detail.get_edit_url }}" data-toggle="tooltip" title="EDIT" role="button" aria-pressed="true"><i class="fas fa-edit"></i></a>
                <a href="{{ post_detail.get_delete_url }}" data-toggle="tooltip" title="DELETE" role="button" aria-pressed="true"><i class="fas fa-trash"></i></a>
            </div>
            {% endif %}
            <br>
            <hr>
           <p class="lead">Comments:</p>
           <div class="card">
            <h5 class='card-header'>Add Comments:</h5>
            <div class="card-body">
                <form action="" method="POST">{% csrf_token %}
                    {{ comment_form|crispy }}
                    <button type="submit" class="btn btn-primary">Post Comment</button>
                </form>
            </div>
          </div>
           {% if comments %}
           {% for comment in comments %}
           <div class="card">
                <div class="card-body">
                <h5 class="card-title">@{{ comment.user }} | <small>{{ comment.timestamp|timesince }} ago</small></h5>
                <p class="card-text">{{ comment.content }}</p>
                {% if comment.user == request.user %}
                <a href="{{ comment.get_delete_url }}" role="button" style="float: right;" aria-pressed="true">DELETE</a>
                {% endif %}
                <p class="card-text">{% if comment.children.count > 0 %}{% if comment.children.count == 1 %}
                    1 Reply | {% else %}{{comment.children.count}} Replies | {% endif %}{% else %}No Reply | {% endif %}<a class='comment-reply-btn' href="">Reply</a></p>
                <div class="comment-reply" style="display: none;">
                    <h5 class='card-header'>Reply:</h5>
                    {% for child in comment.children %}
                    <div class="card-body">
                        <h5 class="card-title">@{{ child.user }} | <small>{{ child.timestamp|timesince }} ago</small></h5>
                        <p class="card-text">{{ child.content }}</p>
                        {% if child.user == request.user %}
                        <a href="{{ child.get_delete_url }}" role="button" style="float: right;" aria-pressed="true">DELETE</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                    <div class="card-body">
                        <h6 class='card-header'>Add Reply:</h6>
                        <form action="" method="POST">{% csrf_token %}
                            {{ comment_form|crispy }}
                            <input type="hidden" name="parent_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-primary">Reply</button>
                        </form>
                    </div>
                </div>
            </div>
            </div>
           {% endfor %}
           {% else %}
                <p>No Comments Found</p>
           {% endif %}
        </div>   
    </div>
</div>
{% endblock %}